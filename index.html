<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yarn Dye Studio Manager</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            line-height: 1.5;
        }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-white { background-color: #ffffff; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-purple-50 { background-color: #faf5ff; }
        .bg-purple-600 { background-color: #9333ea; }
        .bg-purple-700 { background-color: #7e22ce; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-yellow-50 { background-color: #fefce8; }
        .bg-red-50 { background-color: #fef2f2; }
        
        .text-white { color: #ffffff; }
        .text-gray-300 { color: #d1d5db; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-900 { color: #111827; }
        .text-purple-100 { color: #f3e8ff; }
        .text-purple-600 { color: #9333ea; }
        .text-purple-700 { color: #7e22ce; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-700 { color: #1d4ed8; }
        .text-green-600 { color: #16a34a; }
        .text-green-700 { color: #15803d; }
        .text-yellow-600 { color: #ca8a04; }
        .text-yellow-700 { color: #a16207; }
        .text-red-600 { color: #dc2626; }
        .text-red-800 { color: #991b1b; }
        
        .min-h-screen { min-height: 100vh; }
        .container { max-width: 1280px; margin: 0 auto; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .py-12 { padding-top: 3rem; padding-bottom: 3rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        
        .pt-2 { padding-top: 0.5rem; }
        .pt-4 { padding-top: 1rem; }
        .pb-2 { padding-bottom: 0.5rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mr-3 { margin-right: 0.75rem; }
        .ml-auto { margin-left: auto; }
        
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        .space-x-1 > * + * { margin-left: 0.25rem; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        
        .flex { display: flex; }
        .grid { display: grid; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-between { justify-content: space-between; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-full { border-radius: 9999px; }
        
        .border { border: 1px solid #e5e7eb; }
        .border-b { border-bottom: 1px solid #e5e7eb; }
        .border-2 { border: 2px solid #e5e7eb; }
        .border-l-4 { border-left: 4px solid; }
        
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        
        .w-full { width: 100%; }
        .w-6 { width: 1.5rem; }
        .w-12 { width: 3rem; }
        .w-20 { width: 5rem; }
        .w-24 { width: 6rem; }
        .h-6 { height: 1.5rem; }
        .h-12 { height: 3rem; }
        
        .overflow-hidden { overflow: hidden; }
        .overflow-x-auto { overflow-x: auto; }
        .whitespace-nowrap { white-space: nowrap; }
        .whitespace-pre-line { white-space: pre-line; }
        .capitalize { text-transform: capitalize; }
        .uppercase { text-transform: uppercase; }
        
        .sticky { position: sticky; }
        .top-0 { top: 0; }
        .z-10 { z-index: 10; }
        
        .divide-y > * + * { border-top: 1px solid #e5e7eb; }
        
        button, input, select, textarea {
            font-family: inherit;
            font-size: 100%;
        }
        
        button {
            cursor: pointer;
            border: none;
            background: none;
        }
        
        input, select, textarea {
            outline: none;
            border: 1px solid #d1d5db;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #9333ea;
            ring: 2px solid #9333ea;
            box-shadow: 0 0 0 2px rgba(147, 51, 234, 0.2);
        }
        
        .hover\:bg-purple-700:hover { background-color: #7e22ce; }
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-gray-300:hover { background-color: #d1d5db; }
        .hover\:bg-red-50:hover { background-color: #fef2f2; }
        .hover\:bg-blue-50:hover { background-color: #eff6ff; }
        .hover\:text-gray-900:hover { color: #111827; }
        .hover\:text-blue-800:hover { color: #1e40af; }
        .hover\:text-red-800:hover { color: #991b1b; }
        .hover\:text-purple-700:hover { color: #7e22ce; }
        
        .transition-colors { transition-property: color, background-color, border-color; transition-duration: 150ms; }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .tab-active { border-bottom: 3px solid #667eea; color: #667eea; }
        .status-dyeing { background-color: #fef3c7; color: #92400e; }
        .status-drying { background-color: #dbeafe; color: #1e40af; }
        .status-ready { background-color: #d1fae5; color: #065f46; }
        .status-sold { background-color: #e5e7eb; color: #374151; }
        .low-stock { background-color: #fee2e2; border-left: 4px solid #ef4444; }
        
        .flex-1 { flex: 1; }
        
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
            .md\:flex { display: flex; }
        }
        
        @media (min-width: 1024px) {
            .lg\:grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
            .lg\:grid-cols-6 { grid-template-columns: repeat(6, 1fr); }
        }
        
        table { border-collapse: collapse; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Initialize Supabase client
        const supabase = window.supabase.createClient(
            'https://hqjuyceebdujenrrtoth.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxanV5Y2VlYmR1amVucnJ0b3RoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NjI0MzgsImV4cCI6MjA4NjEzODQzOH0.JH7smh8TBaQ8QdLvFrqsuR2v04N2Ks-JZnydXOWVu2w'
        );

        // Fixed user ID (no authentication required)
        const USER_ID = 'default-user';

        // Storage utilities using Supabase
        const StorageManager = {
            async get(key) {
                try {
                    if (key === 'settings') {
                        const { data, error } = await supabase
                            .from('settings')
                            .select('settings_data')
                            .eq('user_id', USER_ID)
                            .maybeSingle();
                        
                        if (error) {
                            console.error(`Error fetching settings:`, error);
                            return null;
                        }
                        return data?.settings_data || null;
                    }

                    const { data, error } = await supabase
                        .from(key)
                        .select('*')
                        .eq('user_id', USER_ID);
                    
                    if (error) {
                        console.error(`Error fetching ${key}:`, error.message, error);
                        return [];
                    }
                    
                    console.log(`Fetched ${key}:`, data?.length || 0, 'items');
                    return data || [];
                } catch (error) {
                    console.error(`Exception in get(${key}):`, error);
                    return key === 'settings' ? null : [];
                }
            },
            
            async set(key, value) {
                try {
                    if (key === 'settings') {
                        const { data, error } = await supabase
                            .from('settings')
                            .upsert({ 
                                user_id: USER_ID, 
                                settings_data: value 
                            }, {
                                onConflict: 'user_id'
                            });
                        
                        if (error) {
                            console.error(`Error saving settings:`, error);
                            return false;
                        }
                        console.log('Settings saved successfully');
                        return true;
                    }

                    // For arrays of data
                    if (Array.isArray(value)) {
                        // Delete existing items
                        const { error: deleteError } = await supabase
                            .from(key)
                            .delete()
                            .eq('user_id', USER_ID);
                        
                        if (deleteError) {
                            console.error(`Error deleting old ${key}:`, deleteError);
                        }
                        
                        // Insert new items
                        if (value.length > 0) {
                            const itemsWithUserId = value.map(item => ({
                                ...item,
                                user_id: USER_ID
                            }));
                            
                            const { data, error } = await supabase
                                .from(key)
                                .insert(itemsWithUserId);
                            
                            if (error) {
                                console.error(`Error inserting ${key}:`, error.message, error);
                                console.log('Attempted to insert:', itemsWithUserId[0]);
                                return false;
                            }
                            console.log(`Saved ${value.length} items to ${key}`);
                        }
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error(`Exception in set(${key}):`, error);
                    return false;
                }
            }
        };

        function YarnDyeManager() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [recipes, setRecipes] = useState([]);
            const [inventory, setInventory] = useState([]);
            const [batches, setBatches] = useState([]);
            const [sales, setSales] = useState([]);
            const [dyeSessions, setDyeSessions] = useState([]);
            const [kits, setKits] = useState([]);
            const [loading, setLoading] = useState(true);
            const [settings, setSettings] = useState({
                colorTypes: ['tonal', 'variegated', 'speckled'],
                inventoryCategories: ['dye', 'yarn base', 'chemical', 'tool', 'ball band', 'other'],
                units: ['ml', 'g', 'tsp', 'tbsp'],
                suppliers: ['Dharma', 'Wool2Dye4', 'Amazon'],
                yarnBaseMappings: [
                    { supplierName: 'W2D4 Merino Bulky SW', myName: 'Luna Bulky' },
                    { supplierName: 'W2D4 SW DK', myName: 'Luna DK' }
                ],
                sizeMappings: [
                    { grams: 100, name: 'Full skein' },
                    { grams: 50, name: 'Half skein' },
                    { grams: 20, name: 'Mini skein' },
                    { grams: 10, name: 'Micro skein' }
                ]
            });

            // Load data on mount
            useEffect(() => {
                loadAllData();
            }, []);

            const loadAllData = async () => {
                setLoading(true);
                try {
                    console.log('Loading data from Supabase...');
                    const recipesData = await StorageManager.get('recipes');
                    const inventoryData = await StorageManager.get('inventory');
                    const batchesData = await StorageManager.get('batches');
                    const salesData = await StorageManager.get('sales');
                    const dyeSessionsData = await StorageManager.get('dye_sessions');
                    const kitsData = await StorageManager.get('kits');
                    const settingsData = await StorageManager.get('settings');
                    
                    console.log('Loaded recipes:', recipesData);
                    console.log('Loaded inventory:', inventoryData);
                    console.log('Loaded batches:', batchesData);
                    
                    setRecipes(recipesData || []);
                    setInventory(inventoryData || []);
                    setBatches(batchesData || []);
                    setSales(salesData || []);
                    setDyeSessions(dyeSessionsData || []);
                    setKits(kitsData || []);
                    setSettings(settingsData || {
                        colorTypes: ['tonal', 'variegated', 'speckled'],
                        inventoryCategories: ['dye', 'yarn base', 'chemical', 'tool', 'ball band', 'other'],
                        units: ['ml', 'g', 'tsp', 'tbsp'],
                        suppliers: ['Dharma', 'Wool2Dye4', 'Amazon'],
                        yarnBaseMappings: [
                            { supplierName: 'W2D4 Merino Bulky SW', myName: 'Luna Bulky' },
                            { supplierName: 'W2D4 SW DK', myName: 'Luna DK' }
                        ],
                        sizeMappings: [
                            { grams: 100, name: 'Full skein' },
                            { grams: 50, name: 'Half skein' },
                            { grams: 20, name: 'Mini skein' },
                            { grams: 10, name: 'Micro skein' }
                        ]
                    });
                    console.log('Data loaded successfully!');
                } catch (error) {
                    console.error('Error loading data:', error);
                }
                setLoading(false);
            };

            const saveRecipes = async (newRecipes) => {
                setRecipes(newRecipes);
                await StorageManager.set('recipes', newRecipes);
            };

            const saveInventory = async (newInventory) => {
                setInventory(newInventory);
                await StorageManager.set('inventory', newInventory);
            };

            const saveBatches = async (newBatches) => {
                setBatches(newBatches);
                await StorageManager.set('batches', newBatches);
            };

            const saveSales = async (newSales) => {
                setSales(newSales);
                await StorageManager.set('sales', newSales);
            };

            const saveDyeSessions = async (newSessions) => {
                setDyeSessions(newSessions);
                await StorageManager.set('dye_sessions', newSessions);
            };

            const saveKits = async (newKits) => {
                setKits(newKits);
                await StorageManager.set('kits', newKits);
            };

            const saveSettings = async (newSettings) => {
                setSettings(newSettings);
                await StorageManager.set('settings', newSettings);
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading your studio...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="gradient-bg text-white shadow-lg">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold">ðŸ§¶ Yarn Dye Studio Manager</h1>
                                    <p className="text-purple-100 mt-1">Professional dyeing business management</p>
                                </div>
                                <button
                                    onClick={() => {
                                        sessionStorage.removeItem('dyestudio_auth');
                                        window.location.reload();
                                    }}
                                    className="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition-colors"
                                >
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="bg-white shadow-sm border-b sticky top-0 z-10">
                        <div className="container mx-auto px-4">
                            <div className="flex space-x-1 overflow-x-auto">
                                {[
                                    { id: 'dashboard', label: 'ðŸ“Š Dashboard', icon: 'ðŸ“Š' },
                                    { id: 'recipes', label: 'ðŸ“ Recipes', icon: 'ðŸ“' },
                                    { id: 'kits', label: 'ðŸŽ Kits', icon: 'ðŸŽ' },
                                    { id: 'sessions', label: 'ðŸŽ¨ Dye Sessions', icon: 'ðŸŽ¨' },
                                    { id: 'upnext', label: 'â–¶ï¸ Up Next', icon: 'â–¶ï¸' },
                                    { id: 'inventory', label: 'ðŸ“¦ Inventory', icon: 'ðŸ“¦' },
                                    { id: 'pipeline', label: 'ðŸ”„ Pipeline', icon: 'ðŸ”„' },
                                    { id: 'sales', label: 'ðŸ’° Sales', icon: 'ðŸ’°' },
                                    { id: 'settings', label: 'âš™ï¸ Settings', icon: 'âš™ï¸' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`px-6 py-4 font-medium whitespace-nowrap transition-colors ${
                                            activeTab === tab.id 
                                                ? 'tab-active' 
                                                : 'text-gray-600 hover:text-gray-900'
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="container mx-auto px-4 py-8">
                        {activeTab === 'dashboard' && (
                            <Dashboard 
                                recipes={recipes} 
                                inventory={inventory} 
                                batches={batches} 
                                sales={sales} 
                            />
                        )}
                        {activeTab === 'recipes' && (
                            <Recipes recipes={recipes} saveRecipes={saveRecipes} settings={settings} inventory={inventory} />
                        )}
                        {activeTab === 'kits' && (
                            <Kits kits={kits} saveKits={saveKits} recipes={recipes} />
                        )}
                        {activeTab === 'sessions' && (
                            <DyeSessions 
                                dyeSessions={dyeSessions} 
                                saveDyeSessions={saveDyeSessions}
                                recipes={recipes}
                                inventory={inventory}
                            />
                        )}
                        {activeTab === 'upnext' && (
                            <UpNext 
                                dyeSessions={dyeSessions}
                                saveDyeSessions={saveDyeSessions}
                                batches={batches}
                                saveBatches={saveBatches}
                                inventory={inventory}
                                saveInventory={saveInventory}
                                recipes={recipes}
                            />
                        )}
                        {activeTab === 'inventory' && (
                            <Inventory inventory={inventory} saveInventory={saveInventory} settings={settings} />
                        )}
                        {activeTab === 'pipeline' && (
                            <Pipeline 
                                batches={batches} 
                                saveBatches={saveBatches} 
                                recipes={recipes}
                                inventory={inventory}
                                saveInventory={saveInventory}
                                settings={settings}
                            />
                        )}
                        {activeTab === 'sales' && (
                            <Sales 
                                sales={sales} 
                                saveSales={saveSales} 
                                batches={batches}
                                saveBatches={saveBatches}
                            />
                        )}
                        {activeTab === 'settings' && (
                            <Settings 
                                settings={settings}
                                saveSettings={saveSettings}
                            />
                        )}
                    </main>
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ recipes, inventory, batches, sales }) {
            const activeBatches = batches.filter(b => b.status !== 'sold').length;
            const lowStock = inventory.filter(i => i.quantity <= i.lowStockThreshold).length;
            const totalRevenue = sales.reduce((sum, s) => sum + parseFloat(s.amount || 0), 0);
            const thisMonthSales = sales.filter(s => {
                const saleDate = new Date(s.date);
                const now = new Date();
                return saleDate.getMonth() === now.getMonth() && saleDate.getFullYear() === now.getFullYear();
            }).length;

            const statusCounts = batches.reduce((acc, batch) => {
                acc[batch.status] = (acc[batch.status] || 0) + 1;
                return acc;
            }, {});

            return (
                <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-900">Studio Overview</h2>
                    
                    {/* Stats Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <StatCard 
                            title="Total Recipes" 
                            value={recipes.length} 
                            icon="ðŸ“"
                            color="purple"
                        />
                        <StatCard 
                            title="Active Batches" 
                            value={activeBatches} 
                            icon="ðŸ”„"
                            color="blue"
                        />
                        <StatCard 
                            title="Low Stock Items" 
                            value={lowStock} 
                            icon="âš ï¸"
                            color={lowStock > 0 ? "red" : "green"}
                        />
                        <StatCard 
                            title="Total Revenue" 
                            value={`$${totalRevenue.toFixed(2)}`} 
                            icon="ðŸ’°"
                            color="green"
                        />
                    </div>

                    {/* Pipeline Status */}
                    <div className="bg-white rounded-lg card-shadow p-6">
                        <h3 className="text-lg font-semibold mb-4">Production Pipeline</h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="text-center p-4 bg-yellow-50 rounded-lg">
                                <div className="text-3xl font-bold text-yellow-700">{statusCounts.dyeing || 0}</div>
                                <div className="text-sm text-yellow-600 mt-1">Dyeing</div>
                            </div>
                            <div className="text-center p-4 bg-blue-50 rounded-lg">
                                <div className="text-3xl font-bold text-blue-700">{statusCounts.drying || 0}</div>
                                <div className="text-sm text-blue-600 mt-1">Drying</div>
                            </div>
                            <div className="text-center p-4 bg-green-50 rounded-lg">
                                <div className="text-3xl font-bold text-green-700">{statusCounts.ready || 0}</div>
                                <div className="text-sm text-green-600 mt-1">Ready for Labels</div>
                            </div>
                            <div className="text-center p-4 bg-gray-50 rounded-lg">
                                <div className="text-3xl font-bold text-gray-700">{statusCounts.sold || 0}</div>
                                <div className="text-sm text-gray-600 mt-1">Sold</div>
                            </div>
                        </div>
                    </div>

                    {/* Recent Activity */}
                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-lg font-semibold mb-4">Recent Sales</h3>
                            {sales.length > 0 ? (
                                <div className="space-y-2">
                                    {sales.slice(-5).reverse().map((sale, idx) => (
                                        <div key={idx} className="flex justify-between items-center py-2 border-b">
                                            <div>
                                                <div className="font-medium">{sale.colorway}</div>
                                                <div className="text-sm text-gray-500">{sale.customer}</div>
                                            </div>
                                            <div className="text-right">
                                                <div className="font-semibold text-green-600">${sale.amount}</div>
                                                <div className="text-xs text-gray-400">{new Date(sale.date).toLocaleDateString()}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <p className="text-gray-400 text-center py-8">No sales yet</p>
                            )}
                        </div>

                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-lg font-semibold mb-4">Low Stock Alert</h3>
                            {lowStock > 0 ? (
                                <div className="space-y-2">
                                    {inventory.filter(i => i.quantity <= i.lowStockThreshold).map((item, idx) => (
                                        <div key={idx} className="flex justify-between items-center p-3 bg-red-50 rounded border-l-4 border-red-500">
                                            <div>
                                                <div className="font-medium">{item.name}</div>
                                                <div className="text-sm text-gray-600">{item.category}</div>
                                            </div>
                                            <div className="text-right">
                                                <div className="font-semibold text-red-600">{item.quantity} {item.unit}</div>
                                                <div className="text-xs text-gray-500">Min: {item.lowStockThreshold}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <p className="text-gray-400 text-center py-8">All items well stocked âœ“</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function StatCard({ title, value, icon, color }) {
            const colors = {
                purple: 'bg-purple-50 text-purple-700',
                blue: 'bg-blue-50 text-blue-700',
                green: 'bg-green-50 text-green-700',
                red: 'bg-red-50 text-red-700'
            };

            return (
                <div className="bg-white rounded-lg card-shadow p-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-sm text-gray-600 mb-1">{title}</p>
                            <p className="text-3xl font-bold text-gray-900">{value}</p>
                        </div>
                        <div className={`text-4xl p-3 rounded-lg ${colors[color]}`}>
                            {icon}
                        </div>
                    </div>
                </div>
            );
        }

        // Recipes Component
        function Recipes({ recipes, saveRecipes, settings, inventory }) {
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterColorType, setFilterColorType] = useState('all');
            const [sortBy, setSortBy] = useState('name');
            const fileInputRef = React.useRef(null);
            const [formData, setFormData] = useState({
                name: '',
                yarnWeight: '',
                colorType: 'tonal',
                ingredients: [{ name: '', amount: '', unit: 'ml' }],
                instructions: '',
                photo: '',
                notes: '',
                created: new Date().toISOString()
            });

            // Get list of dyes from inventory
            const availableDyes = inventory
                .filter(item => item.category === 'dye')
                .map(item => item.name)
                .sort();

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingId) {
                    saveRecipes(recipes.map(r => r.id === editingId ? { ...formData, id: editingId } : r));
                } else {
                    saveRecipes([...recipes, { ...formData, id: Date.now() }]);
                }
                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    yarnWeight: '',
                    colorType: 'tonal',
                    ingredients: [{ name: '', amount: '', unit: 'ml' }],
                    instructions: '',
                    photo: '',
                    notes: '',
                    created: new Date().toISOString()
                });
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
                setShowForm(false);
                setEditingId(null);
            };

            const editRecipe = (recipe) => {
                setFormData(recipe);
                setEditingId(recipe.id);
                setShowForm(true);
                // Clear file input when editing (photo is already in formData)
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            };

            const deleteRecipe = (id) => {
                if (confirm('Delete this recipe?')) {
                    saveRecipes(recipes.filter(r => r.id !== id));
                }
            };

            const addIngredient = () => {
                setFormData({
                    ...formData,
                    ingredients: [...formData.ingredients, { name: '', amount: '', unit: 'ml' }]
                });
            };

            const updateIngredient = (index, field, value) => {
                const newIngredients = [...formData.ingredients];
                newIngredients[index][field] = value;
                setFormData({ ...formData, ingredients: newIngredients });
            };

            const removeIngredient = (index) => {
                setFormData({
                    ...formData,
                    ingredients: formData.ingredients.filter((_, i) => i !== index)
                });
            };

            const handlePhotoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        // Create an image element to compress
                        const img = new Image();
                        img.onload = () => {
                            // Create canvas for compression
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            // Set max dimensions (smaller = less storage)
                            const MAX_WIDTH = 800;
                            const MAX_HEIGHT = 800;
                            
                            let width = img.width;
                            let height = img.height;
                            
                            // Calculate new dimensions while maintaining aspect ratio
                            if (width > height) {
                                if (width > MAX_WIDTH) {
                                    height = Math.round((height * MAX_WIDTH) / width);
                                    width = MAX_WIDTH;
                                }
                            } else {
                                if (height > MAX_HEIGHT) {
                                    width = Math.round((width * MAX_HEIGHT) / height);
                                    height = MAX_HEIGHT;
                                }
                            }
                            
                            // Set canvas dimensions and draw image
                            canvas.width = width;
                            canvas.height = height;
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            // Convert to compressed JPEG (0.7 quality = good balance)
                            const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7);
                            
                            setFormData({ ...formData, photo: compressedDataUrl });
                        };
                        img.src = reader.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const filteredRecipes = recipes
                .filter(r => r.name.toLowerCase().includes(searchTerm.toLowerCase()))
                .filter(r => filterColorType === 'all' || r.colorType === filterColorType)
                .sort((a, b) => {
                    if (sortBy === 'name') {
                        return a.name.localeCompare(b.name);
                    } else if (sortBy === 'colorType') {
                        return a.colorType.localeCompare(b.colorType);
                    }
                    return 0;
                });

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-900">Dye Recipes</h2>
                            <p className="text-sm text-gray-600 mt-1">{recipes.length} recipe{recipes.length !== 1 ? 's' : ''} total</p>
                        </div>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                        >
                            {showForm ? 'âœ• Cancel' : '+ New Recipe'}
                        </button>
                    </div>

                    {/* Search */}
                    <input
                        type="text"
                        placeholder="ðŸ” Search recipes..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    />

                    {/* Filter and Sort */}
                    <div className="grid md:grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Filter by Color Type</label>
                            <select
                                value={filterColorType}
                                onChange={(e) => setFilterColorType(e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                            >
                                <option value="all">All Color Types</option>
                                {(settings.colorTypes || ['tonal', 'variegated', 'speckled']).map(type => (
                                    <option key={type} value={type} className="capitalize">{type}</option>
                                ))}
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Sort by</label>
                            <select
                                value={sortBy}
                                onChange={(e) => setSortBy(e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                            >
                                <option value="name">Colorway Name</option>
                                <option value="colorType">Color Type</option>
                            </select>
                        </div>
                    </div>

                    {/* Form */}
                    {showForm && (
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-xl font-semibold mb-4">{editingId ? 'Edit Recipe' : 'New Recipe'}</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Colorway Name *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="e.g., Deep Ocean Blue"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Yarn Weight (grams) *</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            required
                                            value={formData.yarnWeight}
                                            onChange={(e) => setFormData({ ...formData, yarnWeight: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="e.g., 100"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Ingredients</label>
                                    {formData.ingredients.map((ing, idx) => (
                                        <div key={idx} className="flex gap-2 mb-2">
                                            <div className="flex-1">
                                                <input
                                                    type="text"
                                                    placeholder="Dye/ingredient name"
                                                    value={ing.name}
                                                    onChange={(e) => updateIngredient(idx, 'name', e.target.value)}
                                                    className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                                    list={`dye-list-${idx}`}
                                                />
                                                <datalist id={`dye-list-${idx}`}>
                                                    {availableDyes.map((dye, i) => (
                                                        <option key={i} value={dye} />
                                                    ))}
                                                </datalist>
                                            </div>
                                            <input
                                                type="number"
                                                step="0.01"
                                                placeholder="Amount"
                                                value={ing.amount}
                                                onChange={(e) => updateIngredient(idx, 'amount', e.target.value)}
                                                className="w-24 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            />
                                            <select
                                                value={ing.unit}
                                                onChange={(e) => updateIngredient(idx, 'unit', e.target.value)}
                                                className="w-20 px-2 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            >
                                                {(settings.units || ['ml', 'g', 'tsp', 'tbsp']).map(unit => (
                                                    <option key={unit} value={unit}>{unit}</option>
                                                ))}
                                            </select>
                                            {formData.ingredients.length > 1 && (
                                                <button
                                                    type="button"
                                                    onClick={() => removeIngredient(idx)}
                                                    className="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg"
                                                >
                                                    âœ•
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                    <button
                                        type="button"
                                        onClick={addIngredient}
                                        className="text-purple-600 hover:text-purple-700 text-sm font-medium"
                                    >
                                        + Add Ingredient
                                    </button>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Color Type *</label>
                                    <select
                                        required
                                        value={formData.colorType}
                                        onChange={(e) => setFormData({ ...formData, colorType: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                    >
                                        {(settings.colorTypes || ['tonal', 'variegated', 'speckled']).map(type => (
                                            <option key={type} value={type} className="capitalize">{type}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Instructions</label>
                                    <textarea
                                        value={formData.instructions}
                                        onChange={(e) => setFormData({ ...formData, instructions: e.target.value })}
                                        rows="4"
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Step-by-step dyeing process..."
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Photo</label>
                                    <input
                                        ref={fileInputRef}
                                        type="file"
                                        accept="image/*"
                                        onChange={handlePhotoUpload}
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                    />
                                    {formData.photo && (
                                        <div className="mt-2">
                                            <img src={formData.photo} alt="Recipe preview" className="rounded-lg" style={{maxWidth: '200px', maxHeight: '200px'}} />
                                            <button
                                                type="button"
                                                onClick={() => {
                                                    setFormData({ ...formData, photo: '' });
                                                    if (fileInputRef.current) {
                                                        fileInputRef.current.value = '';
                                                    }
                                                }}
                                                className="text-sm text-red-600 hover:text-red-800 mt-1"
                                            >
                                                Remove photo
                                            </button>
                                        </div>
                                    )}
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        rows="3"
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Any tips, variations, or notes about this colorway..."
                                    />
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="submit"
                                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                    >
                                        {editingId ? 'Update Recipe' : 'Save Recipe'}
                                    </button>
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Recipe List */}
                    <div className="grid md:grid-cols-2 gap-6">
                        {filteredRecipes.map(recipe => (
                            <div key={recipe.id} className="bg-white rounded-lg card-shadow p-6">
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 className="text-xl font-semibold text-gray-900">{recipe.name}</h3>
                                        <div className="flex gap-2 items-center mt-1">
                                            <p className="text-sm text-purple-600 font-medium">{recipe.yarnWeight}g yarn</p>
                                            <span className="text-gray-400">â€¢</span>
                                            <p className="text-sm text-gray-600 capitalize">{recipe.colorType}</p>
                                        </div>
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => editRecipe(recipe)}
                                            className="text-blue-600 hover:bg-blue-50 px-3 py-1 rounded"
                                        >
                                            âœï¸
                                        </button>
                                        <button
                                            onClick={() => deleteRecipe(recipe.id)}
                                            className="text-red-600 hover:bg-red-50 px-3 py-1 rounded"
                                        >
                                            ðŸ—‘ï¸
                                        </button>
                                    </div>
                                </div>

                                {recipe.photo && (
                                    <div className="mb-4">
                                        <img src={recipe.photo} alt={recipe.name} className="rounded-lg w-full" style={{maxHeight: '300px', objectFit: 'cover'}} />
                                    </div>
                                )}

                                <div className="space-y-3">
                                    <div>
                                        <h4 className="font-medium text-sm text-gray-700 mb-1">Ingredients:</h4>
                                        <ul className="text-sm space-y-1">
                                            {recipe.ingredients.map((ing, idx) => (
                                                <li key={idx} className="text-gray-600">
                                                    {ing.name}: {ing.amount}{ing.unit}
                                                </li>
                                            ))}
                                        </ul>
                                    </div>

                                    {recipe.instructions && (
                                        <div>
                                            <h4 className="font-medium text-sm text-gray-700 mb-1">Instructions:</h4>
                                            <p className="text-sm text-gray-600 whitespace-pre-line">{recipe.instructions}</p>
                                        </div>
                                    )}

                                    {recipe.notes && (
                                        <div>
                                            <h4 className="font-medium text-sm text-gray-700 mb-1">Notes:</h4>
                                            <p className="text-sm text-gray-600">{recipe.notes}</p>
                                        </div>
                                    )}

                                    <p className="text-xs text-gray-400 pt-2">
                                        Created: {new Date(recipe.created).toLocaleDateString()}
                                    </p>
                                </div>
                            </div>
                        ))}
                    </div>

                    {filteredRecipes.length === 0 && (
                        <div className="text-center py-12 text-gray-400">
                            <p className="text-xl mb-2">ðŸ“</p>
                            <p>No recipes yet. Create your first dye recipe!</p>
                        </div>
                    )}
                </div>
            );
        }

        // Kits Component
        function Kits({ kits, saveKits, recipes }) {
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                description: '',
                colors: [{ colorwayName: '', quantity: 1 }],
                notes: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingId) {
                    saveKits(kits.map(k => k.id === editingId ? { ...formData, id: editingId } : k));
                } else {
                    saveKits([...kits, { ...formData, id: Date.now(), created: new Date().toISOString() }]);
                }
                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    description: '',
                    colors: [{ colorwayName: '', quantity: 1 }],
                    notes: ''
                });
                setShowForm(false);
                setEditingId(null);
            };

            const editKit = (kit) => {
                setFormData(kit);
                setEditingId(kit.id);
                setShowForm(true);
            };

            const deleteKit = (id) => {
                if (confirm('Delete this kit?')) {
                    saveKits(kits.filter(k => k.id !== id));
                }
            };

            const addColor = () => {
                setFormData({
                    ...formData,
                    colors: [...formData.colors, { colorwayName: '', quantity: 1 }]
                });
            };

            const updateColor = (index, field, value) => {
                const newColors = [...formData.colors];
                newColors[index][field] = value;
                setFormData({ ...formData, colors: newColors });
            };

            const removeColor = (index) => {
                setFormData({
                    ...formData,
                    colors: formData.colors.filter((_, i) => i !== index)
                });
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-900">Yarn Kits</h2>
                            <p className="text-sm text-gray-600 mt-1">{kits.length} kit{kits.length !== 1 ? 's' : ''} total</p>
                        </div>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                        >
                            {showForm ? 'âœ• Cancel' : '+ New Kit'}
                        </button>
                    </div>

                    {/* Form */}
                    {showForm && (
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-xl font-semibold mb-4">{editingId ? 'Edit Kit' : 'New Kit'}</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Kit Name *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="e.g., Autumn Kit"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                        <input
                                            type="text"
                                            value={formData.description}
                                            onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="e.g., Fall-themed colorways"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Colors in Kit</label>
                                    {formData.colors.map((color, idx) => (
                                        <div key={idx} className="flex gap-2 mb-2">
                                            <div className="flex-1">
                                                <input
                                                    type="text"
                                                    placeholder="Colorway name"
                                                    value={color.colorwayName}
                                                    onChange={(e) => updateColor(idx, 'colorwayName', e.target.value)}
                                                    className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                                    list={`colorway-list-${idx}`}
                                                />
                                                <datalist id={`colorway-list-${idx}`}>
                                                    {recipes.map(r => (
                                                        <option key={r.id} value={r.name} />
                                                    ))}
                                                </datalist>
                                            </div>
                                            <input
                                                type="number"
                                                min="1"
                                                placeholder="Qty"
                                                value={color.quantity}
                                                onChange={(e) => updateColor(idx, 'quantity', e.target.value)}
                                                className="w-20 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            />
                                            {formData.colors.length > 1 && (
                                                <button
                                                    type="button"
                                                    onClick={() => removeColor(idx)}
                                                    className="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg"
                                                >
                                                    âœ•
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                    <button
                                        type="button"
                                        onClick={addColor}
                                        className="text-purple-600 hover:text-purple-700 text-sm font-medium"
                                    >
                                        + Add Color
                                    </button>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        rows="2"
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Any additional notes about this kit..."
                                    />
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="submit"
                                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                    >
                                        {editingId ? 'Update Kit' : 'Save Kit'}
                                    </button>
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Kits List */}
                    <div className="grid md:grid-cols-2 gap-6">
                        {kits.map(kit => (
                            <div key={kit.id} className="bg-white rounded-lg card-shadow p-6">
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 className="text-xl font-semibold text-gray-900">{kit.name}</h3>
                                        {kit.description && (
                                            <p className="text-gray-600 text-sm mt-1">{kit.description}</p>
                                        )}
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => editKit(kit)}
                                            className="text-blue-600 hover:bg-blue-50 px-3 py-1 rounded"
                                        >
                                            âœï¸
                                        </button>
                                        <button
                                            onClick={() => deleteKit(kit.id)}
                                            className="text-red-600 hover:bg-red-50 px-3 py-1 rounded"
                                        >
                                            ðŸ—‘ï¸
                                        </button>
                                    </div>
                                </div>

                                <div className="space-y-2">
                                    <h4 className="font-medium text-sm text-gray-700">Colors in Kit:</h4>
                                    <div className="space-y-1">
                                        {kit.colors.map((color, idx) => (
                                            <div key={idx} className="flex justify-between items-center p-2 bg-purple-50 rounded">
                                                <span className="text-gray-900">
                                                    {color.quantity > 1 ? `${color.quantity}x ` : ''}{color.colorwayName}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {kit.notes && (
                                        <div className="pt-2 border-t mt-3">
                                            <p className="text-sm text-gray-600"><strong>Notes:</strong> {kit.notes}</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>

                    {kits.length === 0 && !showForm && (
                        <div className="text-center py-12 text-gray-400">
                            <p className="text-xl mb-2">ðŸŽ</p>
                            <p>No kits yet. Create your first kit!</p>
                        </div>
                    )}
                </div>
            );
        }

        // Dye Sessions Component
        function DyeSessions({ dyeSessions, saveDyeSessions, recipes, inventory }) {
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                date: new Date().toISOString().split('T')[0],
                pans: [],
                notes: ''
            });
            const [currentPan, setCurrentPan] = useState({
                colorway: '',
                recipeId: '',
                capacity: 300,
                yarns: [{ base: '', hankSize: '', quantity: 1 }]
            });

            // Get unique yarn bases and their available hank sizes from inventory
            const yarnBases = inventory
                .filter(item => item.category === 'yarn base')
                .reduce((acc, item) => {
                    if (!acc[item.name]) {
                        acc[item.name] = [];
                    }
                    if (item.hankSize && !acc[item.name].includes(item.hankSize)) {
                        acc[item.name].push(item.hankSize);
                    }
                    return acc;
                }, {});

            const getAvailableHankSizes = (baseName) => {
                return yarnBases[baseName] || [];
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingId) {
                    saveDyeSessions(dyeSessions.map(s => s.id === editingId ? { ...formData, id: editingId } : s));
                } else {
                    saveDyeSessions([...dyeSessions, { ...formData, id: Date.now() }]);
                }
                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    date: new Date().toISOString().split('T')[0],
                    pans: [],
                    notes: ''
                });
                setCurrentPan({
                    colorway: '',
                    recipeId: '',
                    capacity: 300,
                    yarns: [{ base: '', hankSize: '', quantity: 1 }]
                });
                setShowForm(false);
                setEditingId(null);
            };

            const editSession = (session) => {
                setFormData(session);
                setEditingId(session.id);
                setShowForm(true);
            };

            const deleteSession = (id) => {
                if (confirm('Delete this dye session?')) {
                    saveDyeSessions(dyeSessions.filter(s => s.id !== id));
                }
            };

            const addYarnToPan = () => {
                setCurrentPan({
                    ...currentPan,
                    yarns: [...currentPan.yarns, { base: '', hankSize: '', quantity: 1 }]
                });
            };

            const updateYarn = (index, field, value) => {
                const newYarns = [...currentPan.yarns];
                if (field === 'base') {
                    // Reset hankSize when base changes
                    newYarns[index] = { ...newYarns[index], base: value, hankSize: '' };
                } else {
                    newYarns[index][field] = value;
                }
                setCurrentPan({ ...currentPan, yarns: newYarns });
            };

            const removeYarn = (index) => {
                setCurrentPan({
                    ...currentPan,
                    yarns: currentPan.yarns.filter((_, i) => i !== index)
                });
            };

            const addPanToSession = () => {
                if (!currentPan.colorway) {
                    alert('Please enter a colorway for this pan');
                    return;
                }
                const totalWeight = currentPan.yarns.reduce((sum, y) => {
                    return sum + (parseFloat(y.hankSize) || 0) * (parseInt(y.quantity) || 0);
                }, 0);
                
                const recipe = currentPan.recipeId ? recipes.find(r => r.id === parseInt(currentPan.recipeId)) : null;
                
                setFormData({
                    ...formData,
                    pans: [...formData.pans, { 
                        ...currentPan, 
                        id: Date.now(), 
                        totalWeight,
                        recipe: recipe ? {
                            id: recipe.id,
                            name: recipe.name,
                            yarnWeight: recipe.yarnWeight,
                            ingredients: recipe.ingredients,
                            photo: recipe.photo,
                            colorType: recipe.colorType,
                            instructions: recipe.instructions
                        } : null
                    }]
                });
                setCurrentPan({
                    colorway: '',
                    recipeId: '',
                    capacity: 300,
                    yarns: [{ base: '', hankSize: '', quantity: 1 }]
                });
            };

            const removePan = (panId) => {
                setFormData({
                    ...formData,
                    pans: formData.pans.filter(p => p.id !== panId)
                });
            };

            const getTotalWeight = (yarns) => {
                return yarns.reduce((sum, y) => sum + (parseFloat(y.hankSize) || 0) * (parseInt(y.quantity) || 0), 0);
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-gray-900">Dye Sessions Planning</h2>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                        >
                            {showForm ? 'âœ• Cancel' : '+ Plan Session'}
                        </button>
                    </div>

                    {/* Form */}
                    {showForm && (
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-xl font-semibold mb-4">{editingId ? 'Edit Session' : 'Plan New Dye Session'}</h3>
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Session Name *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="e.g., Weekend Batch #1"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Planned Date *</label>
                                        <input
                                            type="date"
                                            required
                                            value={formData.date}
                                            onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        />
                                    </div>
                                </div>

                                {/* Current Pan Builder */}
                                <div className="border-2 border-purple-200 rounded-lg p-4 bg-purple-50">
                                    <h4 className="font-semibold text-gray-900 mb-3">Add Pan to Session</h4>
                                    
                                    <div className="grid md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Colorway *</label>
                                            <input
                                                type="text"
                                                value={currentPan.colorway}
                                                onChange={(e) => setCurrentPan({ ...currentPan, colorway: e.target.value })}
                                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                placeholder="e.g., Cranberry Spice"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Recipe (Optional)</label>
                                            <select
                                                value={currentPan.recipeId}
                                                onChange={(e) => {
                                                    const recipe = recipes.find(r => r.id === parseInt(e.target.value));
                                                    setCurrentPan({ 
                                                        ...currentPan, 
                                                        recipeId: e.target.value,
                                                        colorway: recipe ? recipe.name : currentPan.colorway
                                                    });
                                                }}
                                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                            >
                                                <option value="">Select recipe...</option>
                                                {recipes.map(r => (
                                                    <option key={r.id} value={r.id}>{r.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Pan Capacity (g)</label>
                                        <input
                                            type="number"
                                            value={currentPan.capacity}
                                            onChange={(e) => setCurrentPan({ ...currentPan, capacity: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                        />
                                    </div>

                                    <div className="mb-3">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Yarns in Pan</label>
                                        {currentPan.yarns.map((yarn, idx) => (
                                            <div key={idx} className="flex gap-2 mb-2">
                                                <select
                                                    value={yarn.base}
                                                    onChange={(e) => updateYarn(idx, 'base', e.target.value)}
                                                    className="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                >
                                                    <option value="">Select yarn base...</option>
                                                    {Object.keys(yarnBases).map(baseName => (
                                                        <option key={baseName} value={baseName}>{baseName}</option>
                                                    ))}
                                                </select>
                                                <select
                                                    value={yarn.hankSize}
                                                    onChange={(e) => updateYarn(idx, 'hankSize', e.target.value)}
                                                    className="w-32 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                    disabled={!yarn.base}
                                                >
                                                    <option value="">Size (g)</option>
                                                    {yarn.base && getAvailableHankSizes(yarn.base).map(size => (
                                                        <option key={size} value={size}>{size}g</option>
                                                    ))}
                                                </select>
                                                <input
                                                    type="number"
                                                    placeholder="Qty"
                                                    value={yarn.quantity}
                                                    onChange={(e) => updateYarn(idx, 'quantity', e.target.value)}
                                                    className="w-20 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                />
                                                {currentPan.yarns.length > 1 && (
                                                    <button
                                                        type="button"
                                                        onClick={() => removeYarn(idx)}
                                                        className="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg"
                                                    >
                                                        âœ•
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                        <button
                                            type="button"
                                            onClick={addYarnToPan}
                                            className="text-purple-600 hover:text-purple-700 text-sm font-medium"
                                        >
                                            + Add Yarn
                                        </button>
                                    </div>

                                    <div className="flex justify-between items-center pt-2 border-t">
                                        <div className="text-sm">
                                            <span className="text-gray-600">Total weight: </span>
                                            <span className="font-semibold">{getTotalWeight(currentPan.yarns)}g</span>
                                            <span className="text-gray-600"> / {currentPan.capacity}g capacity</span>
                                        </div>
                                        <button
                                            type="button"
                                            onClick={addPanToSession}
                                            className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium"
                                        >
                                            Add Pan to Session
                                        </button>
                                    </div>
                                </div>

                                {/* Pans in Session */}
                                {formData.pans.length > 0 && (
                                    <div>
                                        <h4 className="font-semibold text-gray-900 mb-3">Pans in This Session ({formData.pans.length})</h4>
                                        <div className="space-y-2">
                                            {formData.pans.map((pan, idx) => (
                                                <div key={pan.id} className="bg-gray-50 rounded-lg p-4 border">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <div className="font-medium text-gray-900">Pan #{idx + 1}: {pan.colorway}</div>
                                                            <div className="text-sm text-gray-600">{pan.totalWeight}g / {pan.capacity}g capacity</div>
                                                        </div>
                                                        <button
                                                            type="button"
                                                            onClick={() => removePan(pan.id)}
                                                            className="text-red-600 hover:text-red-800"
                                                        >
                                                            âœ•
                                                        </button>
                                                    </div>
                                                    <div className="text-sm text-gray-600">
                                                        {pan.yarns.map((y, i) => (
                                                            <div key={i}>â€¢ {y.quantity}x {y.base} ({y.hankSize}g)</div>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Session Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        rows="3"
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Any notes about this dye session..."
                                    />
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="submit"
                                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                    >
                                        {editingId ? 'Update Session' : 'Save Session'}
                                    </button>
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Sessions List */}
                    <div className="space-y-4">
                        {dyeSessions.map(session => (
                            <div key={session.id} className="bg-white rounded-lg card-shadow p-6">
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 className="text-xl font-semibold text-gray-900">{session.name}</h3>
                                        <p className="text-sm text-gray-500">
                                            {new Date(session.date).toLocaleDateString()} â€¢ {session.pans.length} pan(s)
                                        </p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => editSession(session)}
                                            className="text-blue-600 hover:bg-blue-50 px-3 py-1 rounded"
                                        >
                                            âœï¸
                                        </button>
                                        <button
                                            onClick={() => deleteSession(session.id)}
                                            className="text-red-600 hover:bg-red-50 px-3 py-1 rounded"
                                        >
                                            ðŸ—‘ï¸
                                        </button>
                                    </div>
                                </div>

                                <div className="space-y-3">
                                    {session.pans.map((pan, idx) => (
                                        <div key={pan.id} className="border-l-4 border-purple-500 bg-purple-50 rounded p-3">
                                            <div className="font-medium text-gray-900 mb-1">
                                                Pan #{idx + 1}: {pan.colorway}
                                            </div>
                                            <div className="text-sm text-gray-600 mb-2">
                                                Total: {pan.totalWeight}g / {pan.capacity}g capacity
                                            </div>
                                            <div className="text-sm text-gray-700">
                                                {pan.yarns.map((y, i) => (
                                                    <div key={i}>â€¢ {y.quantity}x {y.base} ({y.hankSize}g each)</div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                    
                                    {session.notes && (
                                        <div className="pt-2 border-t">
                                            <p className="text-sm text-gray-600"><strong>Notes:</strong> {session.notes}</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>

                    {dyeSessions.length === 0 && !showForm && (
                        <div className="text-center py-12 text-gray-400">
                            <p className="text-xl mb-2">ðŸŽ¨</p>
                            <p>No dye sessions planned yet. Plan your first session!</p>
                        </div>
                    )}
                </div>
            );
        }

        // Up Next Component
        function UpNext({ dyeSessions, saveDyeSessions, batches, saveBatches, inventory, saveInventory, recipes }) {
            const [selectedSessionId, setSelectedSessionId] = useState('');
            const [currentPanIndex, setCurrentPanIndex] = useState(0);

            // Get upcoming sessions (today or future)
            const today = new Date().toISOString().split('T')[0];
            const upcomingSessions = dyeSessions
                .filter(s => s.date >= today && s.pans.length > 0)
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            // Auto-select first session if none selected
            React.useEffect(() => {
                if (!selectedSessionId && upcomingSessions.length > 0) {
                    setSelectedSessionId(upcomingSessions[0].id.toString());
                    setCurrentPanIndex(0);
                }
            }, [upcomingSessions.length]);

            const selectedSession = dyeSessions.find(s => s.id === parseInt(selectedSessionId));
            const currentPan = selectedSession?.pans[currentPanIndex];
            
            // Get fresh recipe data if pan has a recipe
            const currentRecipe = currentPan?.recipeId 
                ? recipes.find(r => r.id === parseInt(currentPan.recipeId))
                : (currentPan?.recipe || null);

            const scaleIngredients = (recipe, targetWeight) => {
                if (!recipe || !recipe.ingredients) return [];
                const scaleFactor = targetWeight / parseFloat(recipe.yarnWeight || 100);
                return recipe.ingredients.map(ing => ({
                    ...ing,
                    scaledAmount: (parseFloat(ing.amount) * scaleFactor).toFixed(2)
                }));
            };

            const markPanComplete = () => {
                if (currentPanIndex < selectedSession.pans.length - 1) {
                    setCurrentPanIndex(currentPanIndex + 1);
                } else {
                    if (confirm('All pans in this session are complete! Mark session as finished?')) {
                        finishSession();
                    }
                }
            };

            const finishSession = () => {
                if (!selectedSession) return;

                const confirmMessage = `Finish session "${selectedSession.name}"?\n\nThis will:\n- Create batches in Pipeline for each pan\n- Deduct yarn from inventory\n- Remove this session from Dye Sessions`;
                
                if (!confirm(confirmMessage)) return;

                // Create batches for each pan with yarn details
                const newBatches = selectedSession.pans.map(pan => ({
                    id: Date.now() + Math.random(),
                    recipeId: pan.recipeId || '',
                    recipeName: pan.recipe?.name || pan.colorway,
                    colorway: pan.colorway,
                    customColorway: pan.colorway,
                    skeins: pan.yarns.reduce((sum, y) => sum + parseInt(y.quantity || 0), 0),
                    status: 'dyeing',
                    startDate: selectedSession.date,
                    notes: `From session: ${selectedSession.name}`,
                    yarnDetails: pan.yarns // Store yarn base and hank sizes for ball band tracking
                }));

                saveBatches([...batches, ...newBatches]);

                // Deduct yarn from inventory
                const updatedInventory = [...inventory];
                selectedSession.pans.forEach(pan => {
                    pan.yarns.forEach(yarnInPan => {
                        const inventoryItem = updatedInventory.find(
                            item => item.category === 'yarn base' && 
                                    item.name === yarnInPan.base && 
                                    parseFloat(item.hankSize) === parseFloat(yarnInPan.hankSize)
                        );
                        
                        if (inventoryItem) {
                            const quantityToDeduct = parseInt(yarnInPan.quantity || 0);
                            inventoryItem.quantity = Math.max(0, parseFloat(inventoryItem.quantity) - quantityToDeduct);
                        }
                    });
                });
                saveInventory(updatedInventory);

                // Remove session from dyeSessions
                saveDyeSessions(dyeSessions.filter(s => s.id !== selectedSession.id));

                // Reset selection
                setCurrentPanIndex(0);
                setSelectedSessionId('');

                alert('Session completed! Batches added to Pipeline and inventory updated.');
            };

            const goToPreviousPan = () => {
                if (currentPanIndex > 0) {
                    setCurrentPanIndex(currentPanIndex - 1);
                }
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-gray-900">Up Next - Current Dye Session</h2>
                    </div>

                    {upcomingSessions.length === 0 ? (
                        <div className="bg-white rounded-lg card-shadow p-12 text-center">
                            <p className="text-xl text-gray-400 mb-4">ðŸ“…</p>
                            <p className="text-gray-600 mb-2">No upcoming dye sessions planned</p>
                            <p className="text-sm text-gray-500">Go to Dye Sessions to plan your next session!</p>
                        </div>
                    ) : (
                        <>
                            {/* Session Selector and Finish Button */}
                            <div className="bg-white rounded-lg card-shadow p-4">
                                <div className="flex gap-4 items-end">
                                    <div className="flex-1">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Active Session</label>
                                        <select
                                            value={selectedSessionId}
                                            onChange={(e) => {
                                                setSelectedSessionId(e.target.value);
                                                setCurrentPanIndex(0);
                                            }}
                                            className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500 text-lg font-medium"
                                        >
                                            {upcomingSessions.map(session => (
                                                <option key={session.id} value={session.id}>
                                                    {session.name} - {new Date(session.date).toLocaleDateString()} ({session.pans.length} pans)
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <button
                                        onClick={finishSession}
                                        className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium whitespace-nowrap"
                                    >
                                        ðŸ Finish Session
                                    </button>
                                </div>
                            </div>

                            {selectedSession && currentPan && (
                                <>
                                    {/* Progress Bar */}
                                    <div className="bg-white rounded-lg card-shadow p-4">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm font-medium text-gray-700">
                                                Pan {currentPanIndex + 1} of {selectedSession.pans.length}
                                            </span>
                                            <span className="text-sm text-gray-500">
                                                {Math.round(((currentPanIndex + 1) / selectedSession.pans.length) * 100)}% Complete
                                            </span>
                                        </div>
                                        <div className="w-full bg-gray-200 rounded-full h-3">
                                            <div 
                                                className="bg-purple-600 h-3 rounded-full transition-all"
                                                style={{ width: `${((currentPanIndex + 1) / selectedSession.pans.length) * 100}%` }}
                                            />
                                        </div>
                                    </div>

                                    {/* Current Pan Details */}
                                    <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg card-shadow p-6 border-2 border-purple-300">
                                        <div className="mb-4">
                                            <div className="flex justify-between items-start gap-4 mb-4">
                                                <div className="flex gap-4 items-start flex-1">
                                                    {currentRecipe?.photo && (
                                                        <img 
                                                            src={currentRecipe.photo} 
                                                            alt={currentPan.colorway}
                                                            className="rounded-lg border-2 border-purple-300 shadow-md flex-shrink-0"
                                                            style={{width: '120px', height: '120px', objectFit: 'cover'}}
                                                        />
                                                    )}
                                                    <div className="flex-1">
                                                        <h3 className="text-2xl font-bold text-gray-900 mb-1">
                                                            ðŸŽ¨ {currentPan.colorway}
                                                        </h3>
                                                        <p className="text-purple-700 font-medium mb-2">
                                                            Pan #{currentPanIndex + 1} â€¢ {currentPan.totalWeight}g total
                                                        </p>
                                                        {currentRecipe?.colorType && (
                                                            <p className="text-sm text-gray-700">
                                                                <span className="font-medium">Color Type:</span> <span className="capitalize">{currentRecipe.colorType}</span>
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* Navigation Buttons - Full Width Row */}
                                            <div className="flex gap-3 w-full">
                                                <button
                                                    onClick={goToPreviousPan}
                                                    disabled={currentPanIndex === 0}
                                                    style={{
                                                        backgroundColor: currentPanIndex === 0 ? '#d1d5db' : '#9333ea',
                                                        color: currentPanIndex === 0 ? '#9ca3af' : '#ffffff',
                                                        cursor: currentPanIndex === 0 ? 'not-allowed' : 'pointer'
                                                    }}
                                                    className="flex-1 px-6 py-3 rounded-lg font-semibold text-lg transition-colors shadow-md"
                                                    onMouseEnter={(e) => {
                                                        if (currentPanIndex !== 0) {
                                                            e.target.style.backgroundColor = '#7e22ce';
                                                        }
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        if (currentPanIndex !== 0) {
                                                            e.target.style.backgroundColor = '#9333ea';
                                                        }
                                                    }}
                                                >
                                                    â† Previous Pan
                                                </button>
                                                <button
                                                    onClick={markPanComplete}
                                                    style={{
                                                        backgroundColor: '#16a34a',
                                                        color: '#ffffff'
                                                    }}
                                                    className="flex-1 px-6 py-3 rounded-lg font-semibold text-lg transition-colors shadow-md"
                                                    onMouseEnter={(e) => {
                                                        e.target.style.backgroundColor = '#15803d';
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        e.target.style.backgroundColor = '#16a34a';
                                                    }}
                                                >
                                                    {currentPanIndex < selectedSession.pans.length - 1 ? 'Next Pan â†’' : 'Complete Session âœ“'}
                                                </button>
                                            </div>
                                        </div>

                                        {/* Instructions */}
                                        {currentRecipe?.instructions && (
                                            <div className="bg-white rounded-lg p-4 mb-4">
                                                <h4 className="font-semibold text-gray-900 mb-2">Instructions:</h4>
                                                <p className="text-gray-700 whitespace-pre-line">{currentRecipe.instructions}</p>
                                            </div>
                                        )}

                                        {/* Yarns in Pan */}
                                        <div className="bg-white rounded-lg p-4 mb-4">
                                            <h4 className="font-semibold text-gray-900 mb-3">Yarns in This Pan:</h4>
                                            <div className="space-y-2">
                                                {currentPan.yarns.map((yarn, idx) => (
                                                    <div key={idx} className="flex justify-between items-center p-3 bg-purple-50 rounded border-l-4 border-purple-500">
                                                        <span className="font-medium">
                                                            {yarn.quantity}x {yarn.base} ({yarn.hankSize}g each)
                                                        </span>
                                                        <span className="text-purple-700 font-semibold">
                                                            {yarn.quantity * parseFloat(yarn.hankSize)}g total
                                                        </span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Recipe & Scaled Ingredients */}
                                        {currentRecipe ? (
                                            <div className="bg-white rounded-lg p-4">
                                                <h4 className="font-semibold text-gray-900 mb-3">
                                                    Recipe: {currentRecipe.name}
                                                    <span className="text-sm text-gray-500 ml-2">
                                                        (scaled from {currentRecipe.yarnWeight}g to {currentPan.totalWeight}g)
                                                    </span>
                                                </h4>
                                                <div className="space-y-2">
                                                    {scaleIngredients(currentRecipe, currentPan.totalWeight).map((ing, idx) => (
                                                        <div key={idx} className="flex justify-between items-center p-3 bg-blue-50 rounded">
                                                            <span className="font-medium text-gray-900">{ing.name}</span>
                                                            <div className="text-right">
                                                                <span className="text-blue-700 font-bold text-lg">
                                                                    {ing.scaledAmount}{ing.unit}
                                                                </span>
                                                                <span className="text-xs text-gray-500 ml-2">
                                                                    (original: {ing.amount}{ing.unit})
                                                                </span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                                                <p className="text-yellow-800">
                                                    âš ï¸ No recipe linked to this pan. Ingredients need to be calculated manually.
                                                </p>
                                            </div>
                                        )}
                                    </div>

                                    {/* Upcoming Pans Preview */}
                                    {currentPanIndex < selectedSession.pans.length - 1 && (
                                        <div className="bg-white rounded-lg card-shadow p-4">
                                            <h4 className="font-semibold text-gray-700 mb-3">Coming Up Next:</h4>
                                            <div className="space-y-2">
                                                {selectedSession.pans.slice(currentPanIndex + 1, currentPanIndex + 4).map((pan, idx) => (
                                                    <div key={pan.id} className="flex justify-between items-center p-3 bg-gray-50 rounded border">
                                                        <div>
                                                            <span className="font-medium text-gray-900">
                                                                Pan #{currentPanIndex + idx + 2}: {pan.colorway}
                                                            </span>
                                                            <span className="text-sm text-gray-500 ml-2">
                                                                ({pan.totalWeight}g)
                                                            </span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </>
                            )}
                        </>
                    )}
                </div>
            );
        }

        // Inventory Component
        function Inventory({ inventory, saveInventory, settings }) {
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [filterCategory, setFilterCategory] = useState('all');
            const [formData, setFormData] = useState({
                name: '',
                category: 'dye',
                quantity: '',
                unit: 'g',
                hankSize: '',
                lowStockThreshold: '',
                cost: '',
                supplier: '',
                notes: ''
            });

            const categories = settings.inventoryCategories || ['dye', 'yarn base', 'chemical', 'tool', 'other'];

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingId) {
                    saveInventory(inventory.map(i => i.id === editingId ? { ...formData, id: editingId } : i));
                } else {
                    saveInventory([...inventory, { ...formData, id: Date.now() }]);
                }
                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    category: 'dye',
                    quantity: '',
                    unit: 'g',
                    lowStockThreshold: '',
                    cost: '',
                    supplier: '',
                    notes: ''
                });
                setShowForm(false);
                setEditingId(null);
            };

            const editItem = (item) => {
                setFormData(item);
                setEditingId(item.id);
                setShowForm(true);
            };

            const deleteItem = (id) => {
                if (confirm('Delete this item?')) {
                    saveInventory(inventory.filter(i => i.id !== id));
                }
            };

            const adjustQuantity = (id, delta) => {
                saveInventory(inventory.map(i => 
                    i.id === id ? { ...i, quantity: Math.max(0, parseFloat(i.quantity) + delta) } : i
                ));
            };

            const filteredInventory = filterCategory === 'all' 
                ? inventory 
                : inventory.filter(i => i.category === filterCategory);

            const lowStockItems = inventory.filter(i => i.quantity <= i.lowStockThreshold);

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-gray-900">Inventory Management</h2>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                        >
                            {showForm ? 'âœ• Cancel' : '+ Add Item'}
                        </button>
                    </div>

                    {/* Low Stock Alert */}
                    {lowStockItems.length > 0 && !showForm && (
                        <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                            <p className="font-semibold text-red-800">âš ï¸ {lowStockItems.length} item(s) running low!</p>
                        </div>
                    )}

                    {/* Category Filter */}
                    <div className="flex gap-2 overflow-x-auto pb-2">
                        <button
                            onClick={() => setFilterCategory('all')}
                            className={`px-4 py-2 rounded-lg font-medium whitespace-nowrap ${
                                filterCategory === 'all' 
                                    ? 'bg-purple-600 text-white' 
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            All ({inventory.length})
                        </button>
                        {categories.map(cat => (
                            <button
                                key={cat}
                                onClick={() => setFilterCategory(cat)}
                                className={`px-4 py-2 rounded-lg font-medium whitespace-nowrap capitalize ${
                                    filterCategory === cat 
                                        ? 'bg-purple-600 text-white' 
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                {cat} ({inventory.filter(i => i.category === cat).length})
                            </button>
                        ))}
                    </div>

                    {/* Form */}
                    {showForm && (
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-xl font-semibold mb-4">{editingId ? 'Edit Item' : 'New Item'}</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Item Name *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="e.g., Acid Blue 113 or Luna DK"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                                        <select
                                            required
                                            value={formData.category}
                                            onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        >
                                            {categories.map(cat => (
                                                <option key={cat} value={cat} className="capitalize">{cat}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>

                                {formData.category === 'yarn base' && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Hank/Skein Size (g)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={formData.hankSize}
                                            onChange={(e) => setFormData({ ...formData, hankSize: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="e.g., 20, 50, 100"
                                        />
                                    </div>
                                )}

                                <div className="grid md:grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Quantity *</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            required
                                            value={formData.quantity}
                                            onChange={(e) => setFormData({ ...formData, quantity: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Unit *</label>
                                        <select
                                            value={formData.unit}
                                            onChange={(e) => setFormData({ ...formData, unit: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        >
                                            <option value="g">grams (g)</option>
                                            <option value="kg">kilograms (kg)</option>
                                            <option value="ml">milliliters (ml)</option>
                                            <option value="L">liters (L)</option>
                                            <option value="skeins">skeins</option>
                                            <option value="units">units</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Low Stock Alert</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={formData.lowStockThreshold}
                                            onChange={(e) => setFormData({ ...formData, lowStockThreshold: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="Min qty"
                                        />
                                    </div>
                                </div>

                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Cost per Unit</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={formData.cost}
                                            onChange={(e) => setFormData({ ...formData, cost: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="$"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Supplier</label>
                                        <select
                                            value={formData.supplier}
                                            onChange={(e) => setFormData({ ...formData, supplier: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        >
                                            <option value="">Select supplier...</option>
                                            {(settings.suppliers || ['Dharma', 'Wool2Dye4', 'Amazon']).map(supplier => (
                                                <option key={supplier} value={supplier}>{supplier}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        rows="2"
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                    />
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="submit"
                                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                    >
                                        {editingId ? 'Update Item' : 'Add Item'}
                                    </button>
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Inventory Table */}
                    <div className="bg-white rounded-lg card-shadow overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50 border-b">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Item</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cost</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Supplier</th>
                                        <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200">
                                    {filteredInventory.map(item => {
                                        const isLowStock = item.quantity <= item.lowStockThreshold;
                                        return (
                                            <tr key={item.id} className={isLowStock ? 'bg-red-50' : 'hover:bg-gray-50'}>
                                                <td className="px-6 py-4">
                                                    <div className="font-medium text-gray-900">{item.name}</div>
                                                    {item.hankSize && (
                                                        <div className="text-sm text-purple-600">{item.hankSize}g hanks</div>
                                                    )}
                                                    {item.notes && (
                                                        <div className="text-sm text-gray-500">{item.notes}</div>
                                                    )}
                                                </td>
                                                <td className="px-6 py-4 text-sm capitalize">{item.category}</td>
                                                <td className="px-6 py-4">
                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={() => adjustQuantity(item.id, -1)}
                                                            className="w-6 h-6 flex items-center justify-center bg-gray-200 hover:bg-gray-300 rounded"
                                                        >
                                                            -
                                                        </button>
                                                        <span className={`font-medium ${isLowStock ? 'text-red-600' : ''}`}>
                                                            {item.quantity} {item.unit}
                                                        </span>
                                                        <button
                                                            onClick={() => adjustQuantity(item.id, 1)}
                                                            className="w-6 h-6 flex items-center justify-center bg-gray-200 hover:bg-gray-300 rounded"
                                                        >
                                                            +
                                                        </button>
                                                    </div>
                                                    {isLowStock && (
                                                        <div className="text-xs text-red-600 mt-1">
                                                            âš ï¸ Below {item.lowStockThreshold} {item.unit}
                                                        </div>
                                                    )}
                                                </td>
                                                <td className="px-6 py-4 text-sm">
                                                    {item.cost ? `$${item.cost}/${item.unit}` : '-'}
                                                </td>
                                                <td className="px-6 py-4 text-sm">{item.supplier || '-'}</td>
                                                <td className="px-6 py-4 text-right">
                                                    <button
                                                        onClick={() => editItem(item)}
                                                        className="text-blue-600 hover:text-blue-800 mr-3"
                                                    >
                                                        âœï¸
                                                    </button>
                                                    <button
                                                        onClick={() => deleteItem(item.id)}
                                                        className="text-red-600 hover:text-red-800"
                                                    >
                                                        ðŸ—‘ï¸
                                                    </button>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>

                        {filteredInventory.length === 0 && (
                            <div className="text-center py-12 text-gray-400">
                                <p className="text-xl mb-2">ðŸ“¦</p>
                                <p>No items in this category yet.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Pipeline Component
        function Pipeline({ batches, saveBatches, recipes, inventory, saveInventory, settings }) {
            const [showForm, setShowForm] = useState(false);
            const [formData, setFormData] = useState({
                recipeId: '',
                customColorway: '',
                skeins: '',
                status: 'dyeing',
                startDate: new Date().toISOString().split('T')[0],
                notes: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                const recipe = recipes.find(r => r.id === parseInt(formData.recipeId));
                const newBatch = {
                    ...formData,
                    id: Date.now(),
                    recipeName: recipe?.name || 'Custom',
                    colorway: formData.customColorway || recipe?.name || 'Custom Colorway'
                };
                saveBatches([...batches, newBatch]);
                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    recipeId: '',
                    customColorway: '',
                    skeins: '',
                    status: 'dyeing',
                    startDate: new Date().toISOString().split('T')[0],
                    notes: ''
                });
                setShowForm(false);
            };

            const updateStatus = (id, newStatus, oldStatus) => {
                // If moving from ready to sold, deduct ball bands
                if (oldStatus === 'ready' && newStatus === 'sold') {
                    const batch = batches.find(b => b.id === id);
                    if (batch && batch.yarnDetails && batch.yarnDetails.length > 0) {
                        const updatedInventory = [...inventory];
                        
                        // For each yarn type in the batch, deduct the ball bands
                        batch.yarnDetails.forEach(yarn => {
                            const quantity = parseInt(yarn.quantity || 0);
                            const hankSize = parseFloat(yarn.hankSize);
                            const yarnBase = yarn.base;
                            
                            // Find matching ball band in inventory
                            const ballBand = updatedInventory.find(item => 
                                item.category === 'ball band' && 
                                item.name === yarnBase &&
                                parseFloat(item.hankSize) === hankSize
                            );
                            
                            if (ballBand) {
                                ballBand.quantity = Math.max(0, parseFloat(ballBand.quantity) - quantity);
                            }
                        });
                        
                        saveInventory(updatedInventory);
                    }
                }
                
                saveBatches(batches.map(b => b.id === id ? { ...b, status: newStatus } : b));
            };

            const deleteBatch = (id) => {
                if (confirm('Delete this batch?')) {
                    saveBatches(batches.filter(b => b.id !== id));
                }
            };

            const statuses = ['dyeing', 'drying', 'ready', 'sold'];
            const statusLabels = {
                dyeing: { label: 'Dyeing', color: 'yellow', emoji: 'ðŸŽ¨' },
                drying: { label: 'Drying', color: 'blue', emoji: 'ðŸ’¨' },
                ready: { label: 'Ready for Labels', color: 'green', emoji: 'âœ“' },
                sold: { label: 'Sold', color: 'gray', emoji: 'ðŸ’°' }
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-gray-900">Production Pipeline</h2>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                        >
                            {showForm ? 'âœ• Cancel' : '+ New Batch'}
                        </button>
                    </div>

                    {/* Form */}
                    {showForm && (
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-xl font-semibold mb-4">Start New Batch</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Recipe</label>
                                        <select
                                            value={formData.recipeId}
                                            onChange={(e) => setFormData({ ...formData, recipeId: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        >
                                            <option value="">Select a recipe (optional)</option>
                                            {recipes.map(r => (
                                                <option key={r.id} value={r.id}>
                                                    {r.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Custom Colorway Name</label>
                                        <input
                                            type="text"
                                            value={formData.customColorway}
                                            onChange={(e) => setFormData({ ...formData, customColorway: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="Override colorway name"
                                        />
                                    </div>
                                </div>

                                <div className="grid md:grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Number of Skeins *</label>
                                        <input
                                            type="number"
                                            required
                                            value={formData.skeins}
                                            onChange={(e) => setFormData({ ...formData, skeins: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Initial Status</label>
                                        <select
                                            value={formData.status}
                                            onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        >
                                            {statuses.filter(s => s !== 'sold').map(status => (
                                                <option key={status} value={status} className="capitalize">
                                                    {statusLabels[status].label}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                        <input
                                            type="date"
                                            value={formData.startDate}
                                            onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        rows="2"
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Any special notes about this batch..."
                                    />
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="submit"
                                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                    >
                                        Start Batch
                                    </button>
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Pipeline View */}
                    <div className="grid md:grid-cols-4 gap-4">
                        {statuses.map(status => {
                            const batchesInStatus = batches.filter(b => b.status === status);
                            const statusInfo = statusLabels[status];
                            
                            return (
                                <div key={status} className="bg-white rounded-lg card-shadow p-4">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="font-semibold text-gray-900">
                                            {statusInfo.emoji} {statusInfo.label}
                                        </h3>
                                        <span className="bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-sm font-medium">
                                            {batchesInStatus.length}
                                        </span>
                                    </div>
                                    
                                    <div className="space-y-3">
                                        {batchesInStatus.map(batch => (
                                            <div key={batch.id} className={`p-3 rounded-lg border-2 status-${status}`}>
                                                <div className="font-medium text-sm mb-1">{batch.colorway}</div>
                                                <div className="text-xs text-gray-600 mb-2">
                                                    {batch.skeins} skeins â€¢ {new Date(batch.startDate).toLocaleDateString()}
                                                </div>
                                                {batch.notes && (
                                                    <div className="text-xs text-gray-500 mb-2">{batch.notes}</div>
                                                )}
                                                
                                                <div className="flex gap-1 mt-2">
                                                    {statuses.map(s => {
                                                        if (s === batch.status) return null;
                                                        const targetStatus = statusLabels[s];
                                                        return (
                                                            <button
                                                                key={s}
                                                                onClick={() => updateStatus(batch.id, s, batch.status)}
                                                                className="text-xs px-2 py-1 bg-white border rounded hover:bg-gray-50"
                                                                title={`Move to ${targetStatus.label}`}
                                                            >
                                                                {targetStatus.emoji}
                                                            </button>
                                                        );
                                                    })}
                                                    <button
                                                        onClick={() => deleteBatch(batch.id)}
                                                        className="text-xs px-2 py-1 bg-white border rounded hover:bg-red-50 ml-auto"
                                                        title="Delete batch"
                                                    >
                                                        ðŸ—‘ï¸
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {batchesInStatus.length === 0 && (
                                            <div className="text-center py-8 text-gray-300 text-sm">
                                                No batches
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {batches.length === 0 && (
                        <div className="text-center py-12 text-gray-400">
                            <p className="text-xl mb-2">ðŸ”„</p>
                            <p>No batches in production yet. Start your first batch!</p>
                        </div>
                    )}
                </div>
            );
        }

        // Sales Component
        function Sales({ sales, saveSales, batches, saveBatches }) {
            const [showForm, setShowForm] = useState(false);
            const [formData, setFormData] = useState({
                batchId: '',
                colorway: '',
                customer: '',
                amount: '',
                date: new Date().toISOString().split('T')[0],
                platform: '',
                notes: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                const newSale = { ...formData, id: Date.now() };
                saveSales([...sales, newSale]);
                
                // Mark batch as sold if selected
                if (formData.batchId) {
                    saveBatches(batches.map(b => 
                        b.id === parseInt(formData.batchId) ? { ...b, status: 'sold' } : b
                    ));
                }
                
                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    batchId: '',
                    colorway: '',
                    customer: '',
                    amount: '',
                    date: new Date().toISOString().split('T')[0],
                    platform: '',
                    notes: ''
                });
                setShowForm(false);
            };

            const deleteSale = (id) => {
                if (confirm('Delete this sale?')) {
                    saveSales(sales.filter(s => s.id !== id));
                }
            };

            const readyBatches = batches.filter(b => b.status === 'ready');
            const totalRevenue = sales.reduce((sum, s) => sum + parseFloat(s.amount || 0), 0);
            const avgSale = sales.length > 0 ? totalRevenue / sales.length : 0;

            // Sales by month
            const salesByMonth = sales.reduce((acc, sale) => {
                const month = new Date(sale.date).toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                acc[month] = (acc[month] || 0) + parseFloat(sale.amount || 0);
                return acc;
            }, {});

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-gray-900">Sales Tracking</h2>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                        >
                            {showForm ? 'âœ• Cancel' : '+ Record Sale'}
                        </button>
                    </div>

                    {/* Stats */}
                    <div className="grid md:grid-cols-3 gap-6">
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <div className="text-sm text-gray-600 mb-1">Total Sales</div>
                            <div className="text-3xl font-bold text-gray-900">{sales.length}</div>
                        </div>
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <div className="text-sm text-gray-600 mb-1">Total Revenue</div>
                            <div className="text-3xl font-bold text-green-600">${totalRevenue.toFixed(2)}</div>
                        </div>
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <div className="text-sm text-gray-600 mb-1">Average Sale</div>
                            <div className="text-3xl font-bold text-purple-600">${avgSale.toFixed(2)}</div>
                        </div>
                    </div>

                    {/* Form */}
                    {showForm && (
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-xl font-semibold mb-4">Record New Sale</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Link to Batch (Optional)</label>
                                        <select
                                            value={formData.batchId}
                                            onChange={(e) => {
                                                const batch = batches.find(b => b.id === parseInt(e.target.value));
                                                setFormData({ 
                                                    ...formData, 
                                                    batchId: e.target.value,
                                                    colorway: batch?.colorway || formData.colorway
                                                });
                                            }}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        >
                                            <option value="">Select a ready batch</option>
                                            {readyBatches.map(b => (
                                                <option key={b.id} value={b.id}>
                                                    {b.colorway} ({b.skeins} skeins)
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Colorway Name *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.colorway}
                                            onChange={(e) => setFormData({ ...formData, colorway: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        />
                                    </div>
                                </div>

                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Customer Name</label>
                                        <input
                                            type="text"
                                            value={formData.customer}
                                            onChange={(e) => setFormData({ ...formData, customer: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Platform</label>
                                        <input
                                            type="text"
                                            value={formData.platform}
                                            onChange={(e) => setFormData({ ...formData, platform: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                            placeholder="e.g., Etsy, Instagram, In-person"
                                        />
                                    </div>
                                </div>

                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Sale Amount * ($)</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            required
                                            value={formData.amount}
                                            onChange={(e) => setFormData({ ...formData, amount: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Sale Date *</label>
                                        <input
                                            type="date"
                                            required
                                            value={formData.date}
                                            onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        rows="2"
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                    />
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="submit"
                                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                    >
                                        Record Sale
                                    </button>
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Sales by Month */}
                    {Object.keys(salesByMonth).length > 0 && (
                        <div className="bg-white rounded-lg card-shadow p-6">
                            <h3 className="text-lg font-semibold mb-4">Revenue by Month</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                {Object.entries(salesByMonth).reverse().map(([month, amount]) => (
                                    <div key={month} className="text-center p-3 bg-purple-50 rounded-lg">
                                        <div className="text-sm text-gray-600 mb-1">{month}</div>
                                        <div className="text-lg font-bold text-purple-600">${amount.toFixed(2)}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Sales List */}
                    <div className="bg-white rounded-lg card-shadow overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50 border-b">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Colorway</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Platform</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                                        <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200">
                                    {sales.slice().reverse().map(sale => (
                                        <tr key={sale.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 text-sm">{new Date(sale.date).toLocaleDateString()}</td>
                                            <td className="px-6 py-4">
                                                <div className="font-medium">{sale.colorway}</div>
                                                {sale.notes && (
                                                    <div className="text-sm text-gray-500">{sale.notes}</div>
                                                )}
                                            </td>
                                            <td className="px-6 py-4 text-sm">{sale.customer || '-'}</td>
                                            <td className="px-6 py-4 text-sm">{sale.platform || '-'}</td>
                                            <td className="px-6 py-4 text-sm font-semibold text-green-600">${sale.amount}</td>
                                            <td className="px-6 py-4 text-right">
                                                <button
                                                    onClick={() => deleteSale(sale.id)}
                                                    className="text-red-600 hover:text-red-800"
                                                >
                                                    ðŸ—‘ï¸
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {sales.length === 0 && (
                            <div className="text-center py-12 text-gray-400">
                                <p className="text-xl mb-2">ðŸ’°</p>
                                <p>No sales recorded yet. Record your first sale!</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Settings Component
        function Settings({ settings, saveSettings }) {
            const [activeSection, setActiveSection] = useState('colorTypes');
            const [newItem, setNewItem] = useState('');
            const [newMapping, setNewMapping] = useState({ supplierName: '', myName: '' });
            const [newSizeMapping, setNewSizeMapping] = useState({ grams: '', name: '' });

            const sections = {
                colorTypes: { label: 'Color Types', key: 'colorTypes' },
                inventoryCategories: { label: 'Inventory Categories', key: 'inventoryCategories' },
                units: { label: 'Measurement Units', key: 'units' },
                suppliers: { label: 'Suppliers', key: 'suppliers' },
                yarnBaseMappings: { label: 'Yarn Base Mappings', key: 'yarnBaseMappings' },
                sizeMappings: { label: 'Size Mappings', key: 'sizeMappings' }
            };

            const addItem = () => {
                if (!newItem.trim()) return;
                const currentList = settings[activeSection] || [];
                if (!currentList.includes(newItem.toLowerCase())) {
                    saveSettings({
                        ...settings,
                        [activeSection]: [...currentList, newItem.toLowerCase()]
                    });
                }
                setNewItem('');
            };

            const removeItem = (item) => {
                if (confirm(`Remove "${item}"?`)) {
                    saveSettings({
                        ...settings,
                        [activeSection]: settings[activeSection].filter(i => i !== item)
                    });
                }
            };

            const addYarnBaseMapping = () => {
                if (!newMapping.supplierName || !newMapping.myName) {
                    alert('Please fill in both supplier name and your name');
                    return;
                }
                const currentMappings = settings.yarnBaseMappings || [];
                saveSettings({
                    ...settings,
                    yarnBaseMappings: [...currentMappings, { ...newMapping }]
                });
                setNewMapping({ supplierName: '', myName: '' });
            };

            const removeYarnBaseMapping = (index) => {
                if (confirm('Remove this yarn base mapping?')) {
                    saveSettings({
                        ...settings,
                        yarnBaseMappings: settings.yarnBaseMappings.filter((_, i) => i !== index)
                    });
                }
            };

            const addSizeMapping = () => {
                if (!newSizeMapping.grams || !newSizeMapping.name) {
                    alert('Please fill in both grams and name');
                    return;
                }
                const currentMappings = settings.sizeMappings || [];
                saveSettings({
                    ...settings,
                    sizeMappings: [...currentMappings, { grams: parseFloat(newSizeMapping.grams), name: newSizeMapping.name }]
                });
                setNewSizeMapping({ grams: '', name: '' });
            };

            const removeSizeMapping = (index) => {
                if (confirm('Remove this size mapping?')) {
                    saveSettings({
                        ...settings,
                        sizeMappings: settings.sizeMappings.filter((_, i) => i !== index)
                    });
                }
            };

            return (
                <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-900">Settings</h2>

                    <div className="bg-white rounded-lg card-shadow p-6">
                        <h3 className="text-lg font-semibold mb-4">Manage Dropdown Options</h3>
                        
                        {/* Section Tabs */}
                        <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                            {Object.entries(sections).map(([key, section]) => (
                                <button
                                    key={key}
                                    onClick={() => setActiveSection(key)}
                                    className={`px-4 py-2 rounded-lg font-medium whitespace-nowrap ${
                                        activeSection === key 
                                            ? 'bg-purple-600 text-white' 
                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                    }`}
                                >
                                    {section.label}
                                </button>
                            ))}
                        </div>

                        {/* Add New Item */}
                        {activeSection !== 'yarnBaseMappings' && activeSection !== 'sizeMappings' && (
                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Add New {sections[activeSection].label}
                                </label>
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        value={newItem}
                                        onChange={(e) => setNewItem(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addItem()}
                                        className="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder={`Enter new ${sections[activeSection].label.toLowerCase()}...`}
                                    />
                                    <button
                                        onClick={addItem}
                                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                    >
                                        Add
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Yarn Base Mapping Form */}
                        {activeSection === 'yarnBaseMappings' && (
                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Add Yarn Base Mapping
                                </label>
                                <div className="grid md:grid-cols-2 gap-2 mb-2">
                                    <input
                                        type="text"
                                        value={newMapping.supplierName}
                                        onChange={(e) => setNewMapping({ ...newMapping, supplierName: e.target.value })}
                                        className="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Supplier name (e.g., W2D4 SW DK)"
                                    />
                                    <input
                                        type="text"
                                        value={newMapping.myName}
                                        onChange={(e) => setNewMapping({ ...newMapping, myName: e.target.value })}
                                        className="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Your name (e.g., Luna DK)"
                                    />
                                </div>
                                <button
                                    onClick={addYarnBaseMapping}
                                    className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                >
                                    Add Mapping
                                </button>
                            </div>
                        )}

                        {/* Size Mapping Form */}
                        {activeSection === 'sizeMappings' && (
                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Add Size Mapping
                                </label>
                                <div className="grid md:grid-cols-2 gap-2 mb-2">
                                    <input
                                        type="number"
                                        value={newSizeMapping.grams}
                                        onChange={(e) => setNewSizeMapping({ ...newSizeMapping, grams: e.target.value })}
                                        className="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Size in grams (e.g., 100)"
                                    />
                                    <input
                                        type="text"
                                        value={newSizeMapping.name}
                                        onChange={(e) => setNewSizeMapping({ ...newSizeMapping, name: e.target.value })}
                                        className="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Display name (e.g., Full skein)"
                                    />
                                </div>
                                <button
                                    onClick={addSizeMapping}
                                    className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                >
                                    Add Mapping
                                </button>
                            </div>
                        )}

                        {/* Current Items */}
                        {activeSection !== 'yarnBaseMappings' && activeSection !== 'sizeMappings' && (
                            <div>
                                <h4 className="font-medium text-gray-700 mb-3">
                                    Current {sections[activeSection].label}
                                </h4>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                                    {(settings[activeSection] || []).map((item, idx) => (
                                        <div
                                            key={idx}
                                            className="flex items-center justify-between px-3 py-2 bg-gray-50 rounded-lg border"
                                        >
                                            <span className="capitalize text-sm">{item}</span>
                                            <button
                                                onClick={() => removeItem(item)}
                                                className="text-red-600 hover:text-red-800 ml-2"
                                            >
                                                âœ•
                                            </button>
                                        </div>
                                    ))}
                                </div>
                                {(settings[activeSection] || []).length === 0 && (
                                    <p className="text-gray-400 text-center py-8">No items yet</p>
                                )}
                            </div>
                        )}

                        {/* Yarn Base Mappings List */}
                        {activeSection === 'yarnBaseMappings' && (
                            <div>
                                <h4 className="font-medium text-gray-700 mb-3">Current Yarn Base Mappings</h4>
                                <div className="space-y-2">
                                    {(settings.yarnBaseMappings || []).map((mapping, idx) => (
                                        <div key={idx} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg border">
                                            <div className="flex-1">
                                                <span className="font-medium">{mapping.supplierName}</span>
                                                <span className="mx-2">â†’</span>
                                                <span className="text-purple-600">{mapping.myName}</span>
                                            </div>
                                            <button
                                                onClick={() => removeYarnBaseMapping(idx)}
                                                className="text-red-600 hover:text-red-800 ml-2"
                                            >
                                                âœ•
                                            </button>
                                        </div>
                                    ))}
                                </div>
                                {(settings.yarnBaseMappings || []).length === 0 && (
                                    <p className="text-gray-400 text-center py-8">No mappings yet</p>
                                )}
                            </div>
                        )}

                        {/* Size Mappings List */}
                        {activeSection === 'sizeMappings' && (
                            <div>
                                <h4 className="font-medium text-gray-700 mb-3">Current Size Mappings</h4>
                                <div className="space-y-2">
                                    {(settings.sizeMappings || []).map((mapping, idx) => (
                                        <div key={idx} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg border">
                                            <div className="flex-1">
                                                <span className="font-medium">{mapping.grams}g</span>
                                                <span className="mx-2">â†’</span>
                                                <span className="text-purple-600">{mapping.name}</span>
                                            </div>
                                            <button
                                                onClick={() => removeSizeMapping(idx)}
                                                className="text-red-600 hover:text-red-800 ml-2"
                                            >
                                                âœ•
                                            </button>
                                        </div>
                                    ))}
                                </div>
                                {(settings.sizeMappings || []).length === 0 && (
                                    <p className="text-gray-400 text-center py-8">No mappings yet</p>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Export/Import Data */}
                    <div className="bg-white rounded-lg card-shadow p-6">
                        <h3 className="text-lg font-semibold mb-4">Data Management</h3>
                        <div className="space-y-3">
                            <button
                                onClick={() => {
                                    const data = {
                                        recipes: StorageManager.get('recipes'),
                                        inventory: StorageManager.get('inventory'),
                                        batches: StorageManager.get('batches'),
                                        sales: StorageManager.get('sales'),
                                        dyeSessions: StorageManager.get('dyeSessions'),
                                        kits: StorageManager.get('kits'),
                                        settings: StorageManager.get('settings')
                                    };
                                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = `yarn-dye-backup-${new Date().toISOString().split('T')[0]}.json`;
                                    a.click();
                                }}
                                className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                            >
                                ðŸ“¥ Export All Data (Backup)
                            </button>
                            <p className="text-sm text-gray-500">
                                Download all your recipes, inventory, batches, and sales data as a backup file.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // PASSWORD CONFIGURATION - Change this to your desired password
        const APP_PASSWORD = "dyestudio2026";

        // Password Screen Component
        function PasswordScreen({ onAuthenticated }) {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (password === APP_PASSWORD) {
                    sessionStorage.setItem('dyestudio_auth', 'true');
                    onAuthenticated();
                } else {
                    setError('Incorrect password');
                    setPassword('');
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gray-50">
                    <div style={{maxWidth: '28rem', width: '100%', padding: '1rem'}}>
                        <div className="bg-white rounded-lg card-shadow p-8">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-900 mb-2">ðŸ§¶ Yarn Dye Studio</h1>
                                <p className="text-gray-600">Enter password to access</p>
                            </div>

                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Password
                                    </label>
                                    <input
                                        type="password"
                                        required
                                        value={password}
                                        onChange={(e) => {
                                            setPassword(e.target.value);
                                            setError('');
                                        }}
                                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                        placeholder="Enter password"
                                        autoFocus
                                    />
                                </div>

                                {error && (
                                    <div className="p-3 rounded-lg text-sm bg-red-50 text-red-700">
                                        {error}
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="w-full bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium"
                                >
                                    Access App
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        }

        // App Wrapper with Password Protection
        function App() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const auth = sessionStorage.getItem('dyestudio_auth');
                if (auth === 'true') {
                    setIsAuthenticated(true);
                }
                setLoading(false);
            }, []);

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading...</p>
                        </div>
                    </div>
                );
            }

            if (!isAuthenticated) {
                return <PasswordScreen onAuthenticated={() => setIsAuthenticated(true)} />;
            }

            return <YarnDyeManager />;
        }

        // Render App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>